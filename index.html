<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inscription Tournoi - √âquipes</title>
  <style>
    /* ton CSS existant (inchang√©) */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; padding:20px; }
    .container { max-width:800px; margin:0 auto; background:white; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.3); overflow:hidden; }
    .header { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:40px 30px; text-align:center; }
    .header h1 { font-size:2.5em; margin-bottom:10px; text-shadow:2px 2px 4px rgba(0,0,0,0.2); }
    .header p { font-size:1.1em; opacity:0.95; }
    .form-container { padding:40px 30px; }
    .form-group { margin-bottom:25px; }
    label { display:block; font-weight:600; margin-bottom:8px; color:#333; font-size:1em; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="number"], select, textarea {
      width:100%; padding:12px 15px; border:2px solid #e0e0e0; border-radius:10px; font-size:1em; transition:all .3s ease; font-family:inherit;
    }
    input:focus, select:focus, textarea:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1); }
    textarea { resize:vertical; min-height:100px; }
    .required { color:#e74c3c; margin-left:3px; }
    .players-section { background:#f8f9fa; padding:20px; border-radius:10px; margin-bottom:25px; }
    .players-section h3 { color:#667eea; margin-bottom:15px; font-size:1.3em; }
    .player-input { margin-bottom:12px; }
    .submit-btn { width:100%; padding:15px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border:none; border-radius:10px; font-size:1.2em; font-weight:600; cursor:pointer; transition:transform .2s ease, box-shadow .2s ease; }
    .submit-btn:hover { transform:translateY(-2px); box-shadow:0 10px 25px rgba(102,126,234,0.4); }
    .submit-btn:active { transform:translateY(0); }
    .info-box { background:#e3f2fd; border-left:4px solid #2196f3; padding:15px; margin-bottom:25px; border-radius:5px; }
    .info-box p { color:#1565c0; margin:5px 0; }
    @media (max-width:600px) {
      .header h1 { font-size:1.8em; }
      .form-container { padding:25px 20px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèÜ Inscription au Tournoi</h1>
      <p>Inscrivez votre √©quipe maintenant</p>
    </div>

    <div class="form-container">
      <div class="info-box">
        <p><strong>üìã Informations importantes :</strong></p>
        <p>‚Ä¢ Remplissez tous les champs obligatoires (*)</p>
      </div>

      <form id="registrationForm" action="https://formsubmit.co/hamidarj63@gmail.com" method="POST">
        <input type="hidden" name="_next" value="https://hamidarj05.github.io/tournoi/confirm.html">
        <!-- FormSubmit Configuration -->
        <input type="hidden" name="_subject" value="Nouvelle inscription √©quipe - Tournoi">
        <input type="hidden" name="_cc" value="tournoicmcinterna@gmail.com">
        <input type="hidden" name="_captcha" value="false">
        <input type="hidden" name="_template" value="table">
        
        <!-- Informations de l'√©quipe -->
        <div class="form-group">
          <label for="team_name">Nom de l'√©quipe <span class="required">*</span></label>
          <input type="text" id="team_name" name="Nom_√©quipe" required placeholder="Ex: Les Champions">
        </div> 
        
        <!-- Informations du responsable -->
        <div class="form-group">
          <label for="coach_name">Nom du Capitain <span class="required">*</span></label>
          <input type="text" id="coach_name" name="Nom_responsable" required placeholder="Pr√©nom et nom">
        </div> 

        <div class="form-group">
          <label for="phone">T√©l√©phone du Capitain <span class="required">*</span></label>
          <input type="tel" id="phone" name="T√©l√©phone" required placeholder="0600000000">
        </div>

        <!-- Liste des joueurs -->
        <div class="players-section">
          <h3>üë• Liste des joueurs</h3>
          
          <div class="player-input">
            <label for="player1">Joueur 1 <span class="required">*</span></label>
            <input type="text" id="player1" name="Joueur_1" required placeholder="Pr√©nom et nom">
          </div>

          <div class="player-input">
            <label for="player2">Joueur 2 <span class="required">*</span></label>
            <input type="text" id="player2" name="Joueur_2" required placeholder="Pr√©nom et nom">
          </div>

          <div class="player-input">
            <label for="player3">Joueur 3 <span class="required">*</span></label>
            <input type="text" id="player3" name="Joueur_3" required placeholder="Pr√©nom et nom">
          </div>

          <div class="player-input">
            <label for="player4">Joueur 4 <span class="required">*</span></label>
            <input type="text" id="player4" name="Joueur_4" required placeholder="Pr√©nom et nom">
          </div>

          <div class="player-input">
            <label for="player5">Joueur 5 <span class="required">*</span></label>
            <input type="text" id="player5" name="Joueur_5" required placeholder="Pr√©nom et nom">
          </div>

          <div class="player-input">
            <label for="player6">Joueur 6 (Rempla√ßant)</label>
            <input type="text" id="player6" name="Joueur_6_Rempla√ßant" placeholder="Pr√©nom et nom (optionnel)">
          </div>

          <div class="player-input">
            <label for="player7">Joueur 7 (Rempla√ßant)</label>
            <input type="text" id="player7" name="Joueur_7_Rempla√ßant" placeholder="Pr√©nom et nom (optionnel)">
          </div>
        </div> 
        <button type="submit" class="submit-btn">
          ‚úì Inscrire l'√©quipe
        </button>
      </form>
    </div>
  </div>

  <!-- SCRIPT: ajoute un hidden input ip_address et le remplit (ipify + fallback WebRTC) -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('registrationForm');

      // cr√©er input hidden pour l'IP et l'ajouter au formulaire
      const ipInput = document.createElement('input');
      ipInput.type = 'hidden';
      ipInput.name = 'ip_address';
      ipInput.id = 'ip_address';
      ipInput.value = ''; // initial vide
      form.appendChild(ipInput);

      // Fonction fallback: essayer d'obtenir une IP via WebRTC (peut retourner IP locale)
      function getLocalIPs(timeout = 3000) {
        return new Promise((resolve) => {
          const ips = new Set();
          try {
            const pc = new RTCPeerConnection({iceServers: []});
            pc.createDataChannel('');
            pc.createOffer().then(offer => pc.setLocalDescription(offer)).catch(()=>{});
            pc.onicecandidate = (e) => {
              if (!e || !e.candidate) return;
              const s = e.candidate.candidate;
              const match = s.match(/([0-9]{1,3}(?:\.[0-9]{1,3}){3})/);
              if (match) ips.add(match[1]);
            };
            // arr√™t apr√®s timeout
            setTimeout(() => {
              try { pc.close(); } catch(e){}
              resolve(Array.from(ips)[0] || '');
            }, timeout);
          } catch (err) {
            resolve('');
          }
        });
      }

      // Tentative principale: fetch vers ipify
      function fetchPublicIP() {
        return fetch('https://api.ipify.org?format=json', {cache: 'no-store'})
          .then(r => {
            if (!r.ok) throw new Error('no response');
            return r.json();
          })
          .then(json => json.ip)
          .catch(() => '');
      }

      // Essayer de remplir l'IP au chargement
      (async function tryFillIPOnLoad(){
        let ip = '';
        try {
          ip = await fetchPublicIP();
        } catch(e) { ip = ''; }
        if (!ip) {
          ip = await getLocalIPs();
        }
        if (ip) ipInput.value = ip;
      })();

      // Sur submit: si ip non r√©cup√©r√©e, emp√™cher, r√©cup√©rer puis soumettre
      form.addEventListener('submit', function (e) {
        if (!ipInput.value) {
          e.preventDefault();
          // r√©essayer r√©cup√©ration IP puis soumettre
          fetchPublicIP().then(async (ip) => {
            if (!ip) ip = await getLocalIPs();
            ipInput.value = ip || '';
            // soumettre m√™me si ip vide (pour √©viter blocage)
            form.submit();
          }).catch(async () => {
            const ip = await getLocalIPs();
            ipInput.value = ip || '';
            form.submit();
          });
        }
      });
    });
  </script>
</body>
</html>
